% !TeX root = ../thesis.tex
\section{Cryptosystem}
\subsection{The Supersingular Isogeny Diffie-Hellman protocol}
\label{ch:sidh}

The idea of the SIKE cryptosystem is to establish a Diffie-Hellman key-exchange protocol based on isogenies between supersingular elliptic curves. 



\begin{enumerate}[(1)]
	\item We start by generating the \textit{public parameters}: Choose $e_A,e_B$ and look for a prime $p=2^{e_A}3^{e_B}f\pm1$. Set $q=p^2$ and find a supersingular curve $E$ over $\mathbb{F}_q$. Finally, select points $P_A,Q_A$ s.t. they generate the endomorphism $E[2^{e_A}]$ and $P_B,Q_B$ s.t. $\langle P_B,Q_B\rangle=E[3^{e_B}]$. %TODO: What prevents the points from having an order other than 3^{e_B} 2^{e_A}?
	\item Subsequently Alice and Bob choose \textit{secret parameters} $m_A,n_A$ and $m_B,n_B$ respectively to find the secret points $[m_A]P_A + [n_A]Q_A$ and $[m_B]P_B + [n_B]Q_B$. The groups generated by these points serve as the kernels for the secret isogenies $\phi_A : E \to E/A$ and $\phi_B : E \to E/B$. 
	\item In order to allow Bob compute a secret point in E/A, Alice sends him $\phi_A(P_B)$ and $\phi_A(Q_B)$. Upon receival Bob then finds $T_B = \phi_A([m_B]P_B + [n_B]Q_B)$ in $E/A$ and uses $\langle T_B \rangle$ as kernel for $\phi^{\prime}_B : E/A \to E/BA$. Alice proceeds \textit{mutatis mutandis} with $T_A = \phi_B([m_A]P_A + [n_A]Q_A)$ and computes $\phi^{\prime}_A : E/B \to E/AB$ with $ker(\phi^{\prime}_A)= \langle T_A \rangle$.
	\item As shown in \ref{ch:correctness}, $E/AB \cong E/BA$ and therefore the shared secret key can be generated from $j(E/AB)=j(E/BA)$.
\end{enumerate} 		%TODO: Schaubild anh√§ngen
	The public parameters in this protocol are $e_A,e_B$, $p$, $E$, $E/A$, $E/B$,$P_A,Q_A,P_B,Q_B, \phi_A(P_B)$, $\phi_A(Q_B)$, $\phi_B(P_A)$ and $\phi_B(Q_A)$. Secret parameters entail $m_A,n_A$, $m_B,n_B$, $\phi_A$ and $\phi_B$.\\

The above key-exchange protocol can be adapted in the following way to yield a public-key cryptosystem: 
\begin{enumerate}[(1)]
	\item As (1) above.
	\item Let $\mathcal{H}= \{H_k:k\in K\}$ be a hash function family indexed by a finite set K, where each $H_k$ is a function from $\mathcal{F}_q$ to the message space $\{0,1\}^w$. Choose \textit{secret parameters} $m_A,n_A$, then compute $E/A$, $\phi_A(P_B)$ and $\phi_A(Q_B)$ as above. The \textbf{public key} is ($E/A$, $\phi_A(P_B)$, $\phi_A(Q_B)$, $k\in_R K$) and the \textbf{private key} is ($m_A,n_A,k$).
	\item \textbf{Encryption}: Given a public key ($E/A$, $\phi_A(P_B)$, $\phi_A(Q_B)$, $k\in_R K$) choose two random elements $m_B,n_B$. Then compute $h=H_k(j(E/AB))$ and $c=h\oplus m$. The ciphertext is ($E/B$, $\phi_B(P_A)$, $\phi_B(Q_A)$, $c$).
	\item \textbf{Decryption}: Given a ciphertext ($E/B$, $\phi_B(P_A)$, $\phi_B(Q_A)$, $c$) and a private key ($m_A,n_A,k$) compute the j-invariant $j(E/AB)$ and then $h = H_k(j(E/AB))$, $m=c\oplus h$.
\end{enumerate}

	
\subsection{Security}
It is easy to see that the above protocols could be broken, if an attacker would be able to solve either of the following problems:
	
	\begin{itemize}[\textbullet]
		\item Compute $\phi_A$ given $E$ and $E/A$ ("Decisional Supersingular Isogeny problem")
		\item Find a generator  of $\langle[m_A]P_A + [n_A]Q_A\rangle$ given $E/A$ and $\phi_A(P_B)$, $\phi_A(Q_B)$ ("Computational Supersingular Isogeny problem")
		\item Find the j-invariant of E/AB given E/A, E/B and $\phi_A(P_B)$, $\phi_A(Q_B),\phi_B(P_A)$, $\phi_B(Q_A)$ ("Supersingular Decision Diffie-Hellman problem")
	\end{itemize}

So far, there are no known subexponential algorithms for solving any of these problems. The best known attack against SIKE is the "claw algorithm" with space and time requirement in $\mathcal{O}(p^{1/4})$ on a classical computer and $\mathcal{O}(p^{1/6})$ quantumly. Given $E$ and $E/A$, the attacker starts by computing and storing all $2^{e_A/2}$-degree isogenies of $E$ in a lookup-table with the resulting curve $E^{\prime}$. In a following step he then starts computing $2^{e_A/2}$-degree isogenies $E/A^{\prime}$ of $E/A$ and searches for a collision $E/A^{\prime} \cong E^{\prime}$ in the lookup table, which can be used to calculate $\phi:E \to E/A$ as a composition of the colliding $2^{e_A/2}$-isogenies.\\

The public-key cryptosystem presented above is \textit{IND-CPA-secure}. The proof is very similar to the one for El Gamal since it is essentially El Gamal transposed into the setting of supersingular isogenies. SIKE also provides \textit{IND-CCA} security by transforming the above protocol into a key encapsulation mechanism that works as follows:

\begin{enumerate}[(1)]
	\item \textbf{Setup}: As in \ref{ch:sidh} but we additionally define three hash functions F,G,H, the public key $pk_B=(E/B,\phi_B(P_A),\phi_B(Q_A))$ and Bob's secret key $\beta$.
	\item \textbf{Encapsulation algorithm}: 
	\begin{enumerate}[(i)]
		\item Choose a random string $m\in\{0,1\}^n$ and compute $r=G(m,pk_B)$ where $G$ is a hash function and $0\leq r < 2^{e_A}$.
		\item Compute $\phi_A:E \to E/A$ s.t. $ker(\phi_A) = \langle P_A + [r]Q_A \rangle$.
		\item Compute $\phi^{\prime}_A: E/B \to E/AB$ s.t. $ker(\phi^{\prime}_A) = \langle \phi_B(P_A) + \phi_B([r]Q_A) \rangle$.
		\item Compute $c_1=F(j(E/AB))\oplus m$ where F is a hash function to $\{0,1\}^n$.
		\item Output the ciphertext $c=(E/A,\phi_A(P_B),\phi_A(Q_B),c_1)$.
		\item Output the key $K=H(m,c)$
	\end{enumerate}
	\item \textbf{Decapsulation algorithm}: 
	\begin{enumerate}[(i)]
		\item Input: $c=(E/A,\phi_A(P_B),\phi_A(Q_B),c_1)$
		\item Compute $\phi^{\prime}_B: E/A \to E/BA$ s.t. $ker(\phi^{\prime}_B) = \langle \phi_A(P_B) + \phi_A([\beta]Q_B) \rangle$.
		\item Compute $m^{\prime}=F(j(E/BA))\oplus c_1$.
		\item Compute $r^{\prime}=G(m^{\prime},pk_B)$.
		\item Compute $\phi_{A^{\prime}}:E \to E/A^{\prime}$ s.t. $ker(\phi_A) = \langle P_A + [r^{\prime}]Q_A \rangle$.
		\item If $j(E/A^{\prime})=j(E/A)$ and $\phi_{A^{\prime}}(P_B) = \phi_{A}(P_B)$ and $\phi_{A^{\prime}}(Q_B) = \phi_{A}(Q_B)$ then output $K=H(m^{\prime},c)$; otherwise choose random $s\in\{0,1\}^n$ and output $H(s,c)$.

	\end{enumerate}
	
\end{enumerate}

\subsection{Correctness}
\label{ch:correctness}

$E/AB$ is isomorphic to $E/BA$ iff $ker(\phi_B^{\prime})=ker(\phi_A^{\prime})$. %TODO citation
In the following we will prove that $\phi_B^{\prime}$ and $\phi_A^{\prime}$ have the same kernel indeed.\\

\textbf{Lemma 1:} Let $\phi_1: G_1 \to G_2$ and $\phi_2: G_2 \to G_3$ be group homomorphisms with $ker(\phi_1) = \langle K_1 \rangle$ and $ker(\phi_2) = \phi_1(\langle K_2 \rangle)$. Then for $\phi:G_1 \to G_3$ defined by $\phi=\phi_2 \circ \phi_1$ we have $ker(\phi) =\langle K_1,K_2\rangle$.\\%TODO: cite bennies paper

\textbf{Theorem 2:} $ker(\phi_B^{\prime} \circ \phi_A) = ker(\phi_A^{\prime} \circ \phi_B)$\\
\textbf{Proof:}
\begin{enumerate}[(i)]
	\item $ker(\phi_B^{\prime})=\phi_A(\langle [m_B]P_B + [n_B]Q_B)\rangle)$
	\item $ker(\phi_A)=\langle [m_A]P_A + [n_A]Q_A\rangle$
	\item $ker(\phi_B^{\prime} \circ \phi_A) \stackrel{\text{Lemma 1}}{=} \langle [m_A]P_A + [n_A]Q_A, [m_B]P_B + [n_B]Q_B \rangle$
	\item The application of Lemma 1 on $\phi_A^{\prime} \circ \phi_B$ yields the same kernel
\end{enumerate}



\subsection{Computational Details}


Given $E$ and a generator $R$ of $E[2^{e_A}]$, computing an isogeny $\phi:E \to E/A$ with $ker(\langle R \rangle)$  can be done in $\mathcal{O}(2^{e_A})$ using Velu's formula. %TODO: citation
Since $2^{e_A} \in \mathcal{O}(\sqrt{p})$, computing isogenies this way would render the cryptosystem impractical.\\
	
The solution to this problem is to compute an isogeny of large degree as a composition of isogenies of small degree. Then $\phi = \phi_1 \circ \dots \circ \phi_k \circ [n]$ where $\phi_1 \circ \dots \circ \phi_k$ are isogenies of prime degree that are defined over $\mathbb{F}_q$ and $deg(\phi) = n^2 \prod^k_{i=1} deg(\phi_i)$. While computing the composition of $t$ isogenies of degree $t$ takes time proportional to $t$, the cost of computing the composition in a single step is in $\mathcal{O}(2^t)$. Since isogenous elliptic curves have the same cardinality, we can use this composition method in every step of the protocol.

%TODO: What about computing the parameters of the protocol?